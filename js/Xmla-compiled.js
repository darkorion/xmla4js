var Xmla;
(function(){var B="http://schemas.xmlsoap.org/soap/",C=B+"envelope/",q="SOAP-ENV",L="xmlns:"+q+'="'+C+'"',D=q+':encodingStyle="'+B+'encoding/"',E="urn:schemas-microsoft-com:",v=E+"xml-analysis",M='xmlns="'+v+'"',N="sql",O=E+"xml-sql",w="http://www.w3.org/2001/XMLSchema",x="xsd",P="http://www.w3.org/2001/XMLSchema-instance",Q="xsi",u=v+":rowset",l=v+":mddataset",R=window.ActiveXObject?true:false;function S(a){var b,d=false;function c(){d=true;switch(b.readyState){case 0:a.aborted(b);break;case 4:b.status===
200?a.complete(b):a.error(Xmla.Exception._newError("HTTP_ERROR","_ajax",a));break}}b=R?new ActiveXObject("MSXML2.XMLHTTP.3.0"):new XMLHttpRequest;a.username&&a.password?b.open("POST",a.url,a.async,a.username,a.password):b.open("POST",a.url,a.async);b.onreadystatechange=c;b.setRequestHeader("Accept","text/xml, application/xml");b.setRequestHeader("Content-Type","text/xml");b.send(a.data);!a.async&&!d&&c.call(b);return b}function r(a){return typeof a==="undefined"}function T(a){return typeof a==="number"}
function y(a){return a.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var j=document.getElementsByTagNameNS?function(a,b,d,c){return a.getElementsByTagNameNS(b,c)}:function(a,b,d,c){return d?a.getElementsByTagName(d+":"+c):a.getElementsByTagName(c)},F=document.documentElement.getAttributeNS?function(a,b,d,c){return a.getAttributeNS(b,c)}:function(a,b,d,c){return d?a.getAttribute(d+":"+c):a.getAttribute(c)};function p(a){if(a.innerText)return a.innerText;else if(a.textContent)return a.textContent;
else if(a.normalize){a.normalize();return a.firstChild?a.firstChild.data:null}else{var b="";a=a.childNodes;for(var d=a.length,c=0;c<d;c+=1)b+=a.item(c).data;return b}}function z(a,b,d,c){c||(c="");var e,f,g,i,k,n="\n"+c+"<"+a+">";if(d){n+="\n"+c+" <"+b+">";for(i in d)if(d.hasOwnProperty(i)){k=d[i];n+="\n"+c+"  <"+i+">";if(typeof k==="array"){f=0;for(e=k.length;f<e;f+=1){g=k[f];n+="<Value>"+y(g)+"</Value>"}}else n+=y(k);n+="</"+i+">"}n+="\n"+c+" </"+b+">"}n+="\n"+c+"</"+a+">";return n}var G="RequestType";
function U(a){var b=a.method,d=null,c='<?xml version="1.0" encoding="UTF-8"?>\n<'+q+":Envelope "+L+" "+D+">\n <"+q+":Body>\n  <"+b+" "+M+" "+D+">";switch(b){case Xmla.METHOD_DISCOVER:if(a.requestType)c+="\n   <"+G+">"+a.requestType+"</"+G+">"+z("Restrictions","RestrictionList",a.restrictions,"   ")+z("Properties","PropertyList",a.properties,"   ");else d=Xmla.Exception._newError("MISSING_REQUEST_TYPE","Xmla._getXmlaSoapMessage",a);break;case Xmla.METHOD_EXECUTE:if(a.statement)c+="\n   <Command>\n    <Statement>"+
y(a.statement)+"</Statement>\n   </Command>"+z("Properties","PropertyList",a.properties,"   ");else d=Xmla.Exception._newError("MISSING_REQUEST_TYPE","Xmla._getXmlaSoapMessage",a);break;default:}d!==null&&d._throw();c+="\n  </"+b+">\n </"+q+":Body>\n</"+q+":Envelope>";return c}function h(a,b,d){if(b&&!a)a={};for(var c in b)if(b.hasOwnProperty(c))if(d||r(a[c]))a[c]=b[c];return a}Xmla=function(a){this.listeners={};this.listeners[Xmla.EVENT_REQUEST]=[];this.listeners[Xmla.EVENT_SUCCESS]=[];this.listeners[Xmla.EVENT_ERROR]=
[];this.listeners[Xmla.EVENT_DISCOVER]=[];this.listeners[Xmla.EVENT_DISCOVER_SUCCESS]=[];this.listeners[Xmla.EVENT_DISCOVER_ERROR]=[];this.listeners[Xmla.EVENT_EXECUTE]=[];this.listeners[Xmla.EVENT_EXECUTE_SUCCESS]=[];this.listeners[Xmla.EVENT_EXECUTE_ERROR]=[];this.options=h(h({},Xmla.defaultOptions,true),a,true);return this};Xmla.defaultOptions={requestTimeout:30000,async:false};Xmla.METHOD_DISCOVER="Discover";Xmla.METHOD_EXECUTE="Execute";var s="DISCOVER_",o="MDSCHEMA_",t="DBSCHEMA_";Xmla.DISCOVER_DATASOURCES=
s+"DATASOURCES";Xmla.DISCOVER_PROPERTIES=s+"PROPERTIES";Xmla.DISCOVER_SCHEMA_ROWSETS=s+"SCHEMA_ROWSETS";Xmla.DISCOVER_ENUMERATORS=s+"ENUMERATORS";Xmla.DISCOVER_KEYWORDS=s+"KEYWORDS";Xmla.DISCOVER_LITERALS=s+"LITERALS";Xmla.DBSCHEMA_CATALOGS=t+"CATALOGS";Xmla.DBSCHEMA_COLUMNS=t+"COLUMNS";Xmla.DBSCHEMA_PROVIDER_TYPES=t+"PROVIDER_TYPES";Xmla.DBSCHEMA_SCHEMATA=t+"SCHEMATA";Xmla.DBSCHEMA_TABLES=t+"TABLES";Xmla.DBSCHEMA_TABLES_INFO=t+"TABLES_INFO";Xmla.MDSCHEMA_ACTIONS=o+"ACTIONS";Xmla.MDSCHEMA_CUBES=o+
"CUBES";Xmla.MDSCHEMA_DIMENSIONS=o+"DIMENSIONS";Xmla.MDSCHEMA_FUNCTIONS=o+"FUNCTIONS";Xmla.MDSCHEMA_HIERARCHIES=o+"HIERARCHIES";Xmla.MDSCHEMA_LEVELS=o+"LEVELS";Xmla.MDSCHEMA_MEASURES=o+"MEASURES";Xmla.MDSCHEMA_MEMBERS=o+"MEMBERS";Xmla.MDSCHEMA_PROPERTIES=o+"PROPERTIES";Xmla.MDSCHEMA_SETS=o+"SETS";Xmla.EVENT_REQUEST="request";Xmla.EVENT_SUCCESS="success";Xmla.EVENT_ERROR="error";Xmla.EVENT_EXECUTE="execute";Xmla.EVENT_EXECUTE_SUCCESS="executesuccess";Xmla.EVENT_EXECUTE_ERROR="executeerror";Xmla.EVENT_DISCOVER=
"discover";Xmla.EVENT_DISCOVER_SUCCESS="discoversuccess";Xmla.EVENT_DISCOVER_ERROR="discovererror";Xmla.EVENT_GENERAL=[Xmla.EVENT_REQUEST,Xmla.EVENT_SUCCESS,Xmla.EVENT_ERROR];Xmla.EVENT_DISCOVER_ALL=[Xmla.EVENT_DISCOVER,Xmla.EVENT_DISCOVER_SUCCESS,Xmla.EVENT_DISCOVER_ERROR];Xmla.EVENT_EXECUTE_ALL=[Xmla.EVENT_EXECUTE,Xmla.EVENT_EXECUTE_SUCCESS,Xmla.EVENT_EXECUTE_ERROR];Xmla.EVENT_ALL=[].concat(Xmla.EVENT_GENERAL,Xmla.EVENT_DISCOVER_ALL,Xmla.EVENT_EXECUTE_ALL);Xmla.PROP_DATASOURCEINFO="DataSourceInfo";
Xmla.PROP_CATALOG="Catalog";Xmla.PROP_CUBE="Cube";Xmla.PROP_FORMAT="Format";Xmla.PROP_FORMAT_TABULAR="Tabular";Xmla.PROP_FORMAT_MULTIDIMENSIONAL="Multidimensional";Xmla.PROP_AXISFORMAT="AxisFormat";Xmla.PROP_AXISFORMAT_TUPLE="TupleFormat";Xmla.PROP_AXISFORMAT_CLUSTER="ClusterFormat";Xmla.PROP_AXISFORMAT_CUSTOM="CustomFormat";Xmla.PROP_CONTENT="Content";Xmla.PROP_CONTENT_DATA="Data";Xmla.PROP_CONTENT_NONE="None";Xmla.PROP_CONTENT_SCHEMA="Schema";Xmla.PROP_CONTENT_SCHEMADATA="SchemaData";Xmla.prototype=
{listeners:null,soapMessage:null,response:null,responseText:null,responseXML:null,setOptions:function(a){h(this.options,a,true)},addListener:function(a){var b=a.events;b||Xmla.Exception._newError("NO_EVENTS_SPECIFIED","Xmla.addListener",a)._throw();if(typeof b==="string")b=b==="all"?Xmla.EVENT_ALL:b.split(",");b instanceof Array||Xmla.Exception._newError("WRONG_EVENTS_FORMAT","Xmla.addListener",a)._throw();for(var d=b.length,c,e=0;e<d;e+=1){c=b[e].replace(/\s+/g,"");(c=this.listeners[c])||Xmla.Exception._newError("UNKNOWN_EVENT",
"Xmla.addListener",a)._throw();if(typeof a.handler=="function"){if(!a.scope)a.scope=window;c.push(a)}else Xmla.Exception._newError("INVALID_EVENT_HANDLER","Xmla.addListener",a)._throw()}},_fireEvent:function(a,b,d){var c=this.listeners[a];c||Xmla.Exception._newError("UNKNOWN_EVENT","Xmla._fireEvent",a)._throw();var e=c.length,f=true;if(e)for(var g,i=0;i<e;i+=1){g=c[i];g=g.handler.call(g.scope,a,b,this);if(d&&g===false){f=false;break}}else a==="error"&&b.exception._throw();return f},request:function(a){var b,
d=this;this.responseXML=this.responseText=this.response=null;if(!a.url)if(this.options.url)a.url=this.options.url;else{b=Xmla.Exception._newError("MISSING_URL","Xmla.request",a);b._throw()}a.properties=h(a.properties,this.options.properties,false);a.restrictions=h(a.restrictions,this.options.restrictions,false);if(r(a.async)&&!r(this.options.async))a.async=this.options.async;if(r(a.requestTimeout)&&!r(this.options.requestTimeout))a.requestTimeout=this.options.requestTimeout;if(!a.username&&this.options.username)a.username=
this.options.username;if(!a.password&&this.options.password)a.password=this.options.password;this.soapMessage=b=U(a);b={async:a.async,timeout:a.requestTimeout,data:b,error:function(c){a.exception=c;d._requestError(a)},complete:function(c){a.xhr=c;d._requestSuccess(a)},url:a.url};if(a.username)b.username=a.username;if(a.password)b.password=a.password;if(this._fireEvent(Xmla.EVENT_REQUEST,a,true)&&(a.method==Xmla.METHOD_DISCOVER&&this._fireEvent(Xmla.EVENT_DISCOVER,a)||a.method==Xmla.METHOD_EXECUTE&&
this._fireEvent(Xmla.EVENT_EXECUTE,a)))b=S(b);return this.response},_requestError:function(a){this._fireEvent("error",a)},_requestSuccess:function(a){var b=a.xhr;this.responseXML=b.responseXML;this.responseText=b.responseText;b=a.method;var d=j(this.responseXML,C,q,"Fault");if(d.length){d=d.item(0);a.exception=new Xmla.Exception(Xmla.Exception.TYPE_ERROR,d.getElementsByTagName("faultcode").item(0).childNodes.item(0).data,d.getElementsByTagName("faultstring").item(0).childNodes.item(0).data,null,"_requestSuccess",
a);switch(b){case Xmla.METHOD_DISCOVER:this._fireEvent(Xmla.EVENT_DISCOVER_ERROR,a);break;case Xmla.METHOD_EXECUTE:this._fireEvent(Xmla.EVENT_EXECUTE_ERROR,a);break}this._fireEvent(Xmla.EVENT_ERROR,a)}else{switch(b){case Xmla.METHOD_DISCOVER:var c=new Xmla.Rowset(this.responseXML,a.requestType);this.response=a.rowset=c;this._fireEvent(Xmla.EVENT_DISCOVER_SUCCESS,a);break;case Xmla.METHOD_EXECUTE:d=b=null;var e=a.properties[Xmla.PROP_FORMAT];switch(e){case Xmla.PROP_FORMAT_TABULAR:c=b=new Xmla.Rowset(this.responseXML);
break;case Xmla.PROP_FORMAT_MULTIDIMENSIONAL:c=d=new Xmla.Dataset(this.responseXML);break}a.resultset=b;a.dataset=d;this.response=c;this._fireEvent(Xmla.EVENT_EXECUTE_SUCCESS,a);break}this._fireEvent(Xmla.EVENT_SUCCESS,a)}},execute:function(a){var b=a.properties;if(!b){b={};a.properties=b}h(b,this.options.properties,false);if(!b[Xmla.PROP_CONTENT])b[Xmla.PROP_CONTENT]=Xmla.PROP_CONTENT_SCHEMADATA;if(!b[Xmla.PROP_FORMAT])a.properties[Xmla.PROP_FORMAT]=Xmla.PROP_FORMAT_MULTIDIMENSIONAL;a=h(a,{method:Xmla.METHOD_EXECUTE},
true);return this.request(a)},executeTabular:function(a){if(!a.properties)a.properties={};a.properties[Xmla.PROP_FORMAT]=Xmla.PROP_FORMAT_TABULAR;return this.execute(a)},executeMultiDimensional:function(a){if(!a.properties)a.properties={};a.properties[Xmla.PROP_FORMAT]=Xmla.PROP_FORMAT_MULTIDIMENSIONAL;return this.execute(a)},discover:function(a){a=h(a,{method:Xmla.METHOD_DISCOVER},true);if(!a.requestType)a.requestType=this.options.requestType;return this.request(a)},discoverDataSources:function(a){a=
h(a,{requestType:Xmla.DISCOVER_DATASOURCES},true);return this.discover(a)},discoverProperties:function(a){a=h(a,{requestType:Xmla.DISCOVER_PROPERTIES},true);return this.discover(a)},discoverSchemaRowsets:function(a){a=h(a,{requestType:Xmla.DISCOVER_SCHEMA_ROWSETS},true);return this.discover(a)},discoverEnumerators:function(a){a=h(a,{requestType:Xmla.DISCOVER_ENUMERATORS},true);return this.discover(a)},discoverKeywords:function(a){a=h(a,{requestType:Xmla.DISCOVER_KEYWORDS},true);return this.discover(a)},
discoverLiterals:function(a){a=h(a,{requestType:Xmla.DISCOVER_LITERALS},true);return this.discover(a)},discoverDBCatalogs:function(a){a=h(a,{requestType:Xmla.DBSCHEMA_CATALOGS},true);return this.discover(a)},discoverDBColumns:function(a){a=h(a,{requestType:Xmla.DBSCHEMA_COLUMNS},true);return this.discover(a)},discoverDBProviderTypes:function(a){a=h(a,{requestType:Xmla.DBSCHEMA_PROVIDER_TYPES},true);return this.discover(a)},discoverDBSchemata:function(a){a=h(a,{requestType:Xmla.DBSCHEMA_SCHEMATA},
true);return this.discover(a)},discoverDBTables:function(a){a=h(a,{requestType:Xmla.DBSCHEMA_TABLES},true);return this.discover(a)},discoverDBTablesInfo:function(a){a=h(a,{requestType:Xmla.DBSCHEMA_TABLES_INFO},true);return this.discover(a)},discoverMDActions:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_ACTIONS},true);return this.discover(a)},discoverMDCubes:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_CUBES},true);return this.discover(a)},discoverMDDimensions:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_DIMENSIONS},
true);return this.discover(a)},discoverMDFunctions:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_FUNCTIONS},true);return this.discover(a)},discoverMDHierarchies:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_HIERARCHIES},true);return this.discover(a)},discoverMDLevels:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_LEVELS},true);return this.discover(a)},discoverMDMeasures:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_MEASURES},true);return this.discover(a)},discoverMDMembers:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_MEMBERS},
true);return this.discover(a)},discoverMDProperties:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_PROPERTIES},true);return this.discover(a)},discoverMDSets:function(a){a=h(a,{requestType:Xmla.MDSCHEMA_SETS},true);return this.discover(a)}};function H(a,b){a=j(a,w,x,"complexType");var d=a.length,c,e;for(e=0;e<d;e+=1){c=a.item(e);if(c.getAttribute("name")===b)return c}return null}Xmla.Rowset=function(a,b){this._node=a;this._type=b;this._initData();return this};Xmla.Rowset.MD_DIMTYPE_UNKNOWN=0;Xmla.Rowset.MD_DIMTYPE_TIME=
1;Xmla.Rowset.MD_DIMTYPE_MEASURE=2;Xmla.Rowset.MD_DIMTYPE_OTHER=3;Xmla.Rowset.MD_DIMTYPE_QUANTITATIVE=5;Xmla.Rowset.MD_DIMTYPE_ACCOUNTS=6;Xmla.Rowset.MD_DIMTYPE_CUSTOMERS=7;Xmla.Rowset.MD_DIMTYPE_PRODUCTS=8;Xmla.Rowset.MD_DIMTYPE_SCENARIO=9;Xmla.Rowset.MD_DIMTYPE_UTILIY=10;Xmla.Rowset.MD_DIMTYPE_CURRENCY=11;Xmla.Rowset.MD_DIMTYPE_RATES=12;Xmla.Rowset.MD_DIMTYPE_CHANNEL=13;Xmla.Rowset.MD_DIMTYPE_PROMOTION=14;Xmla.Rowset.MD_DIMTYPE_ORGANIZATION=15;Xmla.Rowset.MD_DIMTYPE_BILL_OF_MATERIALS=16;Xmla.Rowset.MD_DIMTYPE_GEOGRAPHY=
17;Xmla.Rowset.MD_STRUCTURE_FULLYBALANCED=0;Xmla.Rowset.MD_STRUCTURE_RAGGEDBALANCED=1;Xmla.Rowset.MD_STRUCTURE_UNBALANCED=2;Xmla.Rowset.MD_STRUCTURE_NETWORK=3;Xmla.Rowset.MD_USER_DEFINED=1;Xmla.Rowset.MD_SYSTEM_ENABLED=2;Xmla.Rowset.MD_SYSTEM_INTERNAL=4;Xmla.Rowset.MDMEMBER_TYPE_REGULAR=1;Xmla.Rowset.MDMEMBER_TYPE_ALL=2;Xmla.Rowset.MDMEMBER_TYPE_FORMULA=3;Xmla.Rowset.MDMEMBER_TYPE_MEASURE=4;Xmla.Rowset.MDMEMBER_TYPE_UNKNOWN=0;Xmla.Rowset.KEYS={};Xmla.Rowset.KEYS[Xmla.DBSCHEMA_CATALOGS]=["CATALOG_NAME"];
Xmla.Rowset.KEYS[Xmla.DBSCHEMA_COLUMNS]=["TABLE_CATALOG","TABLE_NAME","COLUMN_NAME"];Xmla.Rowset.KEYS[Xmla.DBSCHEMA_PROVIDER_TYPES]=["TYPE_NAME"];Xmla.Rowset.KEYS[Xmla.DBSCHEMA_SCHEMATA]=["CATALOG_NAME","SCHEMA_NAME"];Xmla.Rowset.KEYS[Xmla.DBSCHEMA_TABLES]=["TABLE_CATALOG","TABLE_NAME"];Xmla.Rowset.KEYS[Xmla.DBSCHEMA_TABLES_INFO]=["TABLE_CATALOG","TABLE_NAME"];Xmla.Rowset.KEYS[Xmla.DISCOVER_DATASOURCES]=["DataSourceName"];Xmla.Rowset.KEYS[Xmla.DISCOVER_ENUMERATORS]=["EnumName","ElementName"];Xmla.Rowset.KEYS[Xmla.DISCOVER_KEYWORDS]=
["Keyword"];Xmla.Rowset.KEYS[Xmla.DISCOVER_LITERALS]=["LiteralName"];Xmla.Rowset.KEYS[Xmla.DISCOVER_PROPERTIES]=["PropertyName"];Xmla.Rowset.KEYS[Xmla.DISCOVER_SCHEMA_ROWSETS]=["SchemaName"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_ACTIONS]=["CATALOG_NAME","CUBE_NAME","ACTION_NAME"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_CUBES]=["CATALOG_NAME","CUBE_NAME"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_DIMENSIONS]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_FUNCTIONS]=["FUNCTION_NAME","PARAMETER_LIST"];
Xmla.Rowset.KEYS[Xmla.MDSCHEMA_HIERARCHIES]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME","HIERARCHY_UNIQUE_NAME"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_LEVELS]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME","HIERARCHY_UNIQUE_NAME","LEVEL_UNIQUE_NAME"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_MEASURES]=["CATALOG_NAME","CUBE_NAME","MEASURE_NAME"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_MEMBERS]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME","HIERARCHY_UNIQUE_NAME","LEVEL_UNIQUE_NAME","MEMBER_UNIQUE_NAME"];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_PROPERTIES]=
[];Xmla.Rowset.KEYS[Xmla.MDSCHEMA_SETS]=[];function V(a){return a==="true"?true:false}function W(a){return parseInt(a,10)}function X(a){return parseFloat(a,10)}function I(a){return a}function Y(a){return Date.parse(a)}function Z(a){return a}function J(a,b){for(var d=[],c=a.length,e,f=0;f<c;f+=1){e=a.item(f);d.push(b(p(e)))}return d}function A(a){var b={};switch(a){case "xsd:boolean":b.func=V;b.jsType="boolean";break;case "xsd:decimal":case "xsd:double":case "xsd:float":b.func=X;b.jsType="number";
break;case "xsd:int":case "xsd:integer":case "xsd:nonPositiveInteger":case "xsd:negativeInteger":case "xsd:nonNegativeInteger":case "xsd:positiveInteger":case "xsd:short":case "xsd:byte":case "xsd:long":case "xsd:unsignedLong":case "xsd:unsignedInt":case "xsd:unsignedShort":case "xsd:unsignedByte":b.func=W;b.jsType="number";break;case "xsd:string":b.func=I;b.jsType="string";break;case "xsd:dateTime":b.func=Y;b.jsType="object";break;case "Restrictions":b.func=Z;b.jsType="object";break;default:b.func=
I;b.jsType="object";break}return b}function K(a){var b=p(a);if(a=a.getAttribute("type"))return(converter=A(a))?converter.func(b):b;else return b}Xmla.Rowset.prototype={_node:null,_type:null,_row:null,_rows:null,numRows:null,fieldOrder:null,fields:null,_fieldCount:null,_initData:function(){this.numRows=(this._rows=j(this._node,u,null,"row"))?this._rows.length:0;this.reset();this.fieldOrder=[];this.fields={};this._fieldCount=0;var a=H(this._node,"row");if(a){a=j(a,w,x,"sequence").item(0);a=a.childNodes;
for(var b=a.length,d,c,e,f,g,i,k=0;k<b;k+=1){d=a.item(k);if(d.nodeType===1){c=F(d,O,N,"field");e=d.getAttribute("name");g=d.getAttribute("type");if(g===null&&this._row){f=this._row.getElementsByTagName(e);if(f.length)g=F(f.item(0),P,Q,"type")}if(!g&&this._type==Xmla.DISCOVER_SCHEMA_ROWSETS&&e==="Restrictions")g="Restrictions";f=(f=d.getAttribute("minOccurs"))?parseInt(f,10):1;if(d=d.getAttribute("maxOccurs"))if(d==="unbounded")d=Infinity;else f=parseInt(d,10);else d=1;i=A(g);this.fields[c]={name:e,
label:c,index:this._fieldCount++,type:g,jsType:i.jsType,minOccurs:f,maxOccurs:d,getter:this._createFieldGetter(e,i.func,f,d)};this.fieldOrder.push(c)}}}else Xmla.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Rowset",this._node)._throw()},_createFieldGetter:function(a,b,d,c){var e;if(c===1)if(d===1)e=function(){var f=j(this._row,u,null,a);return b(p(f.item(0)))};else{if(d===0)e=function(){var f=j(this._row,u,null,a);return f.length?b(p(f.item(0))):null}}else if(d===1)e=function(){var f=j(this._row,
u,null,a);return J(f,b)};else if(d===0)e=function(){var f=j(this._row,u,null,a);return f.length?J(f,b):null};return e},getType:function(){return this._type},getFields:function(){for(var a=[],b=this._fieldCount,d=this.fieldOrder,c=0;c<b;c+=1)a[c]=this.fieldDef(d[c]);return a},getFieldNames:function(){for(var a=[],b=0,d=this._fieldCount;b<d;b+=1)a[b]=this.fieldOrder[b];return a},hasMoreRows:function(){return this.numRows>this.rowIndex},next:function(){this.rowIndex+=1;this._row=this._rows.item(this.rowIndex);
return this.rowIndex},curr:function(){return this.rowIndex},rowCount:function(){return this.numRows},reset:function(){this.rowIndex=0;this._row=this.hasMoreRows()?this._rows.item(this.rowIndex):null},fieldDef:function(a){var b=this.fields[a];b||Xmla.Exception._newError("INVALID_FIELD","Xmla.Rowset.fieldDef",a)._throw();return b},fieldIndex:function(a){return this.fieldDef(a).index},fieldName:function(a){var b=this.fieldOrder[a];b||Xmla.Exception._newError("INVALID_FIELD","Xmla.Rowset.fieldDef",a)._throw();
return b},fieldVal:function(a){if(T(a))a=this.fieldName(a);return this.fieldDef(a).getter.call(this)},fieldCount:function(){return this._fieldCount},close:function(){this._rows=this._row=this._node=null},readAsArray:function(a){var b=this.fields,d,c;a||(a=[]);for(d in b)if(b.hasOwnProperty(d)){c=b[d];a[c.index]=c.getter.call(this)}return a},fetchAsArray:function(a){if(this.hasMoreRows()){a=this.readAsArray(a);this.next()}else a=false;return a},readAsObject:function(a){var b=this.fields,d,c;a||(a=
{});for(d in b)if(b.hasOwnProperty(d)){c=b[d];a[d]=c.getter.call(this)}return a},fetchAsObject:function(a){if(this.hasMoreRows()){a=this.readAsObject(a);this.next()}else a=false;return a},fetchCustom:function(a){if(this.hasMoreRows()){a=a.call(this);this.next()}else a=false;return a},fetchAllAsArray:function(a){var b;for(a||(a=[]);b=this.fetchAsArray();)a.push(b);return a},fetchAllAsObject:function(a){var b;for(a||(a=[]);b=this.fetchAsObject();)a.push(b);return a},fetchAllCustom:function(a,b){var d;
for(a||(a=[]);d=this.fetchCustom(b);)a.push(d);return a},mapAsObject:function(a,b,d){var c,e,f=b.length,g=f-1,i=a;for(a=0;a<f;a+=1){c=b[a];c=d[c];if(e=i[c])if(a===g)if(e instanceof Array)e.push(d);else i[c]=[e,d];else i=e;else if(a===g)i[c]=d;else i=i[c]={}}},mapAllAsObject:function(a,b){b||(b={});a||(a=this.getKey());for(var d;d=this.fetchAsObject();)this.mapAsObject(b,a,d);return b},getKey:function(){var a;return a=this._type?Xmla.Rowset.KEYS[this._type]:this.getFieldNames()}};Xmla.Dataset=function(a){this._initDataset(a);
return this};Xmla.Dataset.AXIS_COLUMNS=0;Xmla.Dataset.AXIS_ROWS=1;Xmla.Dataset.AXIS_PAGES=2;Xmla.Dataset.AXIS_SECTIONS=3;Xmla.Dataset.AXIS_CHAPTERS=4;Xmla.Dataset.AXIS_SLICER="SlicerAxis";Xmla.Dataset.prototype={_root:null,_axes:null,_axesOrder:null,_numAxes:null,_slicer:null,_cellset:null,_initDataset:function(a){this._initRoot(a);this.cubeName=p(j(this._root,l,"","CubeName").item(0));this._initAxes();this._initCells()},_initRoot:function(a){var b=j(a,l,"","root");if(b.length)this._root=b.item(0);
else Xmla.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Dataset._initData",a)._throw()},_initAxes:function(){var a,b,d,c,e,f={};this._axes={};this._axesOrder=[];c=j(this._root,l,"","AxisInfo");e=c.length;for(a=0;a<e;a++){b=c.item(a);d=b.getAttribute("name");f[d]=b}c=j(this._root,l,"","Axis");e=c.length;for(a=0;a<e;a++){b=c.item(a);d=b.getAttribute("name");b=new Xmla.Dataset.Axis(f[d],b);if(d==Xmla.Dataset.AXIS_SLICER)this._slicer=b;else{this._axes[d]=b;this._axesOrder.push(b)}}this._numAxes=
this._axesOrder.length},_initCells:function(){this._cellset=new Xmla.Dataset.Cellset(this)},getAxisCount:function(){return this._numAxes},getAxis:function(a){var b;if(isNum(a)){b=this._axesOrder[a];r(a)&&Xmla.Exception._newError("INVALID_AXIS","Xmla.Dataset.getAxis",b)._throw()}else b=a;return a=b==Xmla.Dataset.AXIS_SLICER?this._slicer:this._axes[b]},getColumns:function(){return this.getAxis(Xmla.Dataset.AXIS_COLUMNS)},getRows:function(){return this.getAxis(Xmla.Dataset.AXIS_ROWS)},getSlicer:function(){return this._slicer},
close:function(){this._slicer&&this._slicer.close();for(var a=0;a<this._namAxes;a++)this.getAxis(a).close();this._cellset.close();this._slicer=this._numAxes=this._axesOrder=this._axes=this._root=null}};Xmla.Dataset.Axis=function(a,b){this._initAxis(a,b);return this};Xmla.Dataset.Axis.MEMBER_UNIQUE_NAME="UName";Xmla.Dataset.Axis.MEMBER_CAPTION="Caption";Xmla.Dataset.Axis.MEMBER_LEVEL_NAME="LName";Xmla.Dataset.Axis.MEMBER_LEVEL_NUMBER="LNum";Xmla.Dataset.Axis.MEMBER_DISPLAY_INFO="DisplayInfo";Xmla.Dataset.Axis.prototype=
{_tuples:null,_members:null,numTuples:null,numHierarchies:null,_tupleIndex:null,_hierarchyOrder:null,_hierarchyDefs:null,_initHierarchies:function(a){var b=j(a,l,"","HierarchyInfo"),d=b.length,c,e,f,g,i,k,n;this._hierarchyDefs={};this._hierarchyOrder=[];this.numHierarchies=d;for(c=0;c<d;c++){f=b.item(c);f=f.getAttribute("name");this._hierarchyOrder[c]=f;g={};k=j(a,l,"","*");i=k.length;for(e=0;e<i;e++){n=k.item(e);g[n.tagName]=null}e={index:c,name:f,properties:g};this._hierarchyDefs[f]=e}},_initAxis:function(a,
b){this.name=b.getAttribute("name");this._initHierarchies(a);this._tuples=j(b,l,"","Tuple");this.numTuples=this._tuples.length;this.reset()},_getMembers:function(){return this.tupleIndex<this.numTuples?j(this._tuples.item(this.tupleIndex),l,"","Member"):null},reset:function(){this.tupleIndex=0;this._members=this.hasMoreTuples()?this._getMembers():null},hasMoreTuples:function(){return this.numTuples>this.tupleIndex},next:function(){this.tupleIndex+=1;this._members=this._getMembers();return this.tupleIndex},
tupleCount:function(){return this.numTuples},getHierarchyNames:function(){for(var a=[],b=0,d=this.numHierarchies;b<d;b+=1)a[b]=this._hierarchyOrder[b];return a},hierarchyCount:function(){return this.numHierarchies},hierarchyIndex:function(a){return this._hierarchiesNames[a]},hierarchyName:function(a){return this._hierarchyOrder[a]},hierarchyDef:function(a){var b=this._hierarchyDefs[a];b||Xmla.Exception._newError("INVALID_HIERARCHY","Xmla.Dataset.Axis.hierarchyDef",a)._throw();return b},member:function(a){var b,
d,c,e,f={};switch(typeof a){case "string":b=this.hierarchyIndex(a);d=a;break;case "number":d=this.hierarchyName(a);b=a;break}a=this.hierarchyDef(d);a=a.properties;e=this._members.item(b);f.hierarchy=d;f.index=b;for(c in a){el=j(e,l,"",c);switch(el.length){case 0:f[c]=a[c];break;case 1:f[c]=p(el.item(0));break;default:Xmla.Exception._newError("UNEXPECTED_ERROR_READING_MEMBER","Xmla.Dataset.Axis.member",c)._throw()}}return f},readAsArray:function(a){a||(a=[]);for(var b=0;b<this.numHierarchies;b++)a[b]=
this.member(b);return a},readAsObject:function(a){a||(a={});for(var b=0;b<this.numHierarchies;b++)a[this._hierarchyOrder[b]]=this.member(b);return a},fetchAsArray:function(){var a;if(this.hasMoreTuples()){a=this.readAsArray();this.next()}else a=false;return a},fetchAsObject:function(){var a;if(this.hasMoreTuples()){a=this.readAsObject();this.next()}else a=false;return a},fetchAllAsArray:function(a){var b;for(a||(a=[]);b=this.fetchAsArray();)a.push(b);return a},fetchAllAsObject:function(a){var b;for(a||
(a=[]);b=this.fetchAsObject();)a.push(b);return a}};Xmla.Dataset.Cellset=function(a){this._dataset=a;this._initCellset();return this};Xmla.Dataset.Cellset.prototype={_dataset:null,_cellNodes:null,_cellCount:null,_cellNode:null,_cellDefs:null,_idx:null,_ord:null,_cellOrd:null,_initCellset:function(){var a=this._dataset._root,b,d,c,e,f,g,i,k;(b=H(a,"CellData"))||Xmla.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Rowset",a)._throw();b=j(b,w,x,"element");d=b.length;e=j(a,l,"","CellInfo");if(!e||
e.length==0)Xmla.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Rowset",a)._throw();e=e.item(0);e=j(e,l,"","*");this._cellDefs={};i=e.length;for(k=0;k<i;k+=1){f=e.item(k);g=f.tagName;for(f=0;f<d;f++){c=b.item(f);if(c.getAttribute("name")===g){f={name:g};this._cellDefs[g]=f;if(c=c.getAttribute("type")){f.type=c;if(c=A(c)){f.jsType=c.jsType;f.converter=c.func}}break}}}this._cellNodes=j(a,l,"","Cell");this._cellCount=this._cellNodes.length},_getCellNode:function(){this._cellNode=this._cellNodes.item(this._idx);
this._cellOrd=parseInt(this._cellNode.getAttribute("CellOrdinal"),10)},reset:function(){this._idx=0;this._getCellNode();this._ord=0},hasMoreCells:function(){return this._idx<this._cellCount},next:function(){this._idx+=1;this._cellOrd===this._ord&&this.hasMoreCells()&&this._getCellNode()},curr:function(){return this._idx},cellValue:function(){return K(j(this._cellNode,l,"","Value").item(0))},readAsObject:function(){var a,b,d;if(this._cellOrd===this._ord){a={ordinal:this._ord};for(var c in this._cellDefs){d=
this._cellDefs[c];b=j(this._cellNode,l,"",c).item(0);if(d.type){d=d.converter;a[c]=d(p(b))}else if(c==="Value")a[c]=K(b);a[c]=p(b)}}else if(this._cellOrd>this._ord)a=null;return a},close:function(){this._cellNode=this._cellNodes=this._dataset=null}};Xmla.Exception=function(a,b,d,c,e,f,g){this.type=a;this.code=b;this.message=d;this.source=e;this.helpfile=c;this.data=f;this.args=g;return this};Xmla.Exception.TYPE_WARNING="warning";Xmla.Exception.TYPE_ERROR="error";var m="http://code.google.com/p/xmla4js/wiki/ExceptionCodes";
Xmla.Exception.MISSING_REQUEST_TYPE_CDE=-1;Xmla.Exception.MISSING_REQUEST_TYPE_MSG="Missing_Request_Type";Xmla.Exception.MISSING_REQUEST_TYPE_HLP=m+"#"+Xmla.Exception.MISSING_REQUEST_TYPE_CDE+"_"+Xmla.Exception.MISSING_REQUEST_TYPE_MSG;Xmla.Exception.MISSING_STATEMENT_CDE=-2;Xmla.Exception.MISSING_STATEMENT_MSG="Missing_Statement";Xmla.Exception.MISSING_STATEMENT_HLP=m+"#"+Xmla.Exception.MISSING_STATEMENT_CDE+"_"+Xmla.Exception.MISSING_STATEMENT_MSG;Xmla.Exception.MISSING_URL_CDE=-3;Xmla.Exception.MISSING_URL_MSG=
"Missing_URL";Xmla.Exception.MISSING_URL_HLP=m+"#"+Xmla.Exception.MISSING_URL_CDE+"_"+Xmla.Exception.MISSING_URL_MSG;Xmla.Exception.NO_EVENTS_SPECIFIED_CDE=-4;Xmla.Exception.NO_EVENTS_SPECIFIED_MSG="No_Events_Specified";Xmla.Exception.NO_EVENTS_SPECIFIED_HLP=m+"#"+Xmla.Exception.NO_EVENTS_SPECIFIED_CDE+"_"+Xmla.Exception.NO_EVENTS_SPECIFIED_MSG;Xmla.Exception.WRONG_EVENTS_FORMAT_CDE=-5;Xmla.Exception.WRONG_EVENTS_FORMAT_MSG="Wrong_Events_Format";Xmla.Exception.WRONG_EVENTS_FORMAT_HLP=m+"#"+Xmla.Exception.NO_EVENTS_SPECIFIED_CDE+
"_"+Xmla.Exception.NO_EVENTS_SPECIFIED_MSG;Xmla.Exception.UNKNOWN_EVENT_CDE=-6;Xmla.Exception.UNKNOWN_EVENT_MSG="Unknown_Event";Xmla.Exception.UNKNOWN_EVENT_HLP=m+"#"+Xmla.Exception.UNKNOWN_EVENT_CDE+"_"+Xmla.Exception.UNKNOWN_EVENT_MSG;Xmla.Exception.INVALID_EVENT_HANDLER_CDE=-7;Xmla.Exception.INVALID_EVENT_HANDLER_MSG="Invalid_Events_Handler";Xmla.Exception.INVALID_EVENT_HANDLER_HLP=m+"#"+Xmla.Exception.INVALID_EVENT_HANDLER_CDE+"_"+Xmla.Exception.INVALID_EVENT_HANDLER_MSG;Xmla.Exception.ERROR_PARSING_RESPONSE_CDE=
-8;Xmla.Exception.ERROR_PARSING_RESPONSE_MSG="Error_Parsing_Response";Xmla.Exception.ERROR_PARSING_RESPONSE_HLP=m+"#"+Xmla.Exception.ERROR_PARSING_RESPONSE_CDE+"_"+Xmla.Exception.ERROR_PARSING_RESPONSE_MSG;Xmla.Exception.INVALID_FIELD_CDE=-9;Xmla.Exception.INVALID_FIELD_MSG="Invalid_Field";Xmla.Exception.INVALID_FIELD_HLP=m+"#"+Xmla.Exception.INVALID_FIELD_CDE+"_"+Xmla.Exception.INVALID_FIELD_MSG;Xmla.Exception.HTTP_ERROR_CDE=-10;Xmla.Exception.HTTP_ERROR_MSG="HTTP Error";Xmla.Exception.HTTP_ERROR_HLP=
m+"#"+Xmla.Exception.HTTP_ERROR_CDE+"_"+Xmla.Exception.HTTP_ERROR_MSG;Xmla.Exception.INVALID_HIERARCHY_CDE=-11;Xmla.Exception.INVALID_HIERARCHY_MSG="Invalid_Hierarchy";Xmla.Exception.INVALID_HIERARCHY_HLP=m+"#"+Xmla.Exception.INVALID_HIERARCHY_CDE+"_"+Xmla.Exception.INVALID_HIERARCHY_MSG;Xmla.Exception.UNEXPECTED_ERROR_READING_MEMBER_CDE=-12;Xmla.Exception.UNEXPECTED_ERROR_READING_MEMBER_MSG="Error_Reading_Member";Xmla.Exception.UNEXPECTED_ERROR_READING_MEMBER_HLP=m+"#"+Xmla.Exception.UNEXPECTED_ERROR_READING_MEMBER_CDE+
"_"+Xmla.Exception.UNEXPECTED_ERROR_READING_MEMBER_MSG;Xmla.Exception._newError=function(a,b,d){return new Xmla.Exception(Xmla.Exception.TYPE_ERROR,Xmla.Exception[a+"_CDE"],Xmla.Exception[a+"_MSG"],Xmla.Exception[a+"_HLP"],b,d)};Xmla.Exception.prototype={type:null,code:null,message:null,source:null,helpfile:null,data:null,_throw:function(){throw this;},args:null,getStackTrace:function(){var a="";if(this.args)for(var b=this.args.callee;b;){String(b);b=b.caller}return a}}})();
