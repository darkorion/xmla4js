(function(){var z="http://schemas.xmlsoap.org/soap/",c=z+"envelope/",h='xmlns:SOAP-ENV="'+c+'"',r='SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"',f="urn:schemas-microsoft-com:",s=f+"xml-analysis",e='xmlns="'+s+'"',g=f+"xml-sql",A="http://www.w3.org/2001/XMLSchema",b=s+":rowset",a=window.ActiveXObject?true:false;function d(D){var F;if(a){F=new ActiveXObject("MSXML2.XMLHTTP.3.0")}else{F=new XMLHttpRequest()}F.open("POST",D.url,D.async);var C=false;var E=function(){C=true;switch(F.readyState){case 0:D.aborted(F);break;case 4:if(F.status===200){D.complete(F,"success")}else{D.error(F,F.status,null)}break}};F.onreadystatechange=E;F.setRequestHeader("Content-Type","text/xml");F.send(D.data);if(!D.async&&!C){E.call(F)}return F}function p(C){return typeof(C)==="undefined"}function B(C){return typeof(C)==="function"}function v(C){return typeof(C)==="string"}function x(C){return typeof(C)==="number"}function t(C){return typeof(C)==="object"}function m(C){return C.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var k=function(E,D,C){if(B(E.getElementsByTagNameNS)){return E.getElementsByTagNameNS(D,C)}else{return E.getElementsByTagName(C)}};var l=function(D,E,C){if(B(D.getAttributeNS)){return D.getAttributeNS(E,C)}else{return D.getAttribute(C)}};function q(C,H,F){var D="<"+C+">";if(F){var K;D+="<"+H+">";for(var J in F){if(F.hasOwnProperty(J)){K=F[J];D+="<"+J+">";if(typeof(K)==="array"){for(var I,E=0,G=K.length;E<G;E++){I=K[E];D+="<Value>"+m(I)+"</Value>"}}else{D+=m(K)}D+="</"+J+">"}}D+="</"+H+">"}D+="</"+C+">";return D}function y(C){var E="";var F=C.method;E+="<SOAP-ENV:Envelope "+h+" "+r+"><SOAP-ENV:Body><"+F+" "+e+" "+r+">";var D=null;switch(F){case Xmla.METHOD_DISCOVER:if(p(C.requestType)){D={name:"Missing request type",description:'Requests of the "Discover" method must specify a requestType.'}}else{E+="<"+j+">"+C.requestType+"</"+j+">"+q("Restrictions","RestrictionList",C.restrictions)+q("Properties","PropertyList",C.properties)}break;case Xmla.METHOD_EXECUTE:if(p(C.statement)){D={name:"Missing statement",description:'Requests of the "Execute" method must specify an MDX statement.'}}else{E+="<Command><Statement>"+C.statement+"</Statement></Command>"+q("Properties","PropertyList",C.properties)}break;default:D={name:"Invalid XMLA method",description:'The method must be either "Discover" or "Execute".'}}if(D!==null){throw D}E+="   </"+F+"></SOAP-ENV:Body></SOAP-ENV:Envelope>";return E}function u(D,E,C){if(E&&(!D)){D={}}for(var F in E){if(E.hasOwnProperty(F)){if(C||p(D[F])){D[F]=E[F]}}}return D}Xmla=function(C){this.listeners={};this.listeners[Xmla.EVENT_REQUEST]=[];this.listeners[Xmla.EVENT_SUCCESS]=[];this.listeners[Xmla.EVENT_ERROR]=[];this.listeners[Xmla.EVENT_DISCOVER]=[];this.listeners[Xmla.EVENT_DISCOVER_SUCCESS]=[];this.listeners[Xmla.EVENT_DISCOVER_ERROR]=[];this.listeners[Xmla.EVENT_EXECUTE]=[];this.listeners[Xmla.EVENT_EXECUTE_SUCCESS]=[];this.listeners[Xmla.EVENT_EXECUTE_ERROR]=[];this.options=u(u({},Xmla.defaultOptions,true),C,true)};Xmla.defaultOptions={requestTimeout:30000,async:false};Xmla.METHOD_DISCOVER="Discover";Xmla.METHOD_EXECUTE="Execute";var j="RequestType";var n="DISCOVER_";var i="MDSCHEMA_";var o="DBSCHEMA_";Xmla.DISCOVER_DATASOURCES=n+"DATASOURCES";Xmla.DISCOVER_PROPERTIES=n+"PROPERTIES";Xmla.DISCOVER_SCHEMA_ROWSETS=n+"SCHEMA_ROWSETS";Xmla.DISCOVER_ENUMERATORS=n+"ENUMERATORS";Xmla.DISCOVER_KEYWORDS=n+"KEYWORDS";Xmla.DISCOVER_LITERALS=n+"LITERALS";Xmla.DBSCHEMA_CATALOGS=o+"CATALOGS";Xmla.DBSCHEMA_COLUMNS=o+"COLUMNS";Xmla.DBSCHEMA_PROVIDER_TYPES=o+"PROVIDER_TYPES";Xmla.DBSCHEMA_SCHEMATA=o+"SCHEMATA";Xmla.DBSCHEMA_TABLES=o+"TABLES";Xmla.DBSCHEMA_TABLES_INFO=o+"TABLES_INFO";Xmla.MDSCHEMA_ACTIONS=i+"ACTIONS";Xmla.MDSCHEMA_CUBES=i+"CUBES";Xmla.MDSCHEMA_DIMENSIONS=i+"DIMENSIONS";Xmla.MDSCHEMA_FUNCTIONS=i+"FUNCTIONS";Xmla.MDSCHEMA_HIERARCHIES=i+"HIERARCHIES";Xmla.MDSCHEMA_LEVELS=i+"LEVELS";Xmla.MDSCHEMA_MEASURES=i+"MEASURES";Xmla.MDSCHEMA_MEMBERS=i+"MEMBERS";Xmla.MDSCHEMA_PROPERTIES=i+"PROPERTIES";Xmla.MDSCHEMA_SETS=i+"SETS";Xmla.EVENT_REQUEST="request";Xmla.EVENT_SUCCESS="success";Xmla.EVENT_ERROR="error";Xmla.EVENT_EXECUTE="execute";Xmla.EVENT_EXECUTE_SUCCESS="executesuccess";Xmla.EVENT_EXECUTE_ERROR="executeerror";Xmla.EVENT_DISCOVER="discover";Xmla.EVENT_DISCOVER_SUCCESS="discoversuccess";Xmla.EVENT_DISCOVER_ERROR="discovererror";Xmla.EVENT_GENERAL=[Xmla.EVENT_REQUEST,Xmla.EVENT_SUCCESS,Xmla.EVENT_ERROR];Xmla.EVENT_DISCOVER_ALL=[Xmla.EVENT_DISCOVER,Xmla.EVENT_DISCOVER_SUCCESS,Xmla.EVENT_DISCOVER_ERROR];Xmla.EVENT_EXECUTE_ALL=[Xmla.EVENT_EXECUTE,Xmla.EVENT_EXECUTE_SUCCESS,Xmla.EVENT_EXECUTE_ERROR];Xmla.EVENT_ALL=[].concat(Xmla.EVENT_GENERAL,Xmla.EVENT_DISCOVER_ALL,Xmla.EVENT_EXECUTE_ALL);Xmla.PROP_DATASOURCEINFO="DataSourceInfo";Xmla.PROP_CATALOG="Catalog";Xmla.PROP_CUBE="Cube";Xmla.PROP_FORMAT="Format";Xmla.PROP_FORMAT_TABULAR="Tabular";Xmla.PROP_FORMAT_MULTIDIMENSIONAL="Multidimensional";Xmla.PROP_AXISFORMAT="AxisFormat";Xmla.PROP_AXISFORMAT_TUPLE="TupleFormat";Xmla.PROP_AXISFORMAT_CLUSTER="ClusterFormat";Xmla.PROP_AXISFORMAT_CUSTOM="CustomFormat";Xmla.PROP_CONTENT="Content";Xmla.PROP_CONTENT_DATA="Data";Xmla.PROP_CONTENT_NONE="None";Xmla.PROP_CONTENT_SCHEMA="Schema";Xmla.PROP_CONTENT_SCHEMADATA="SchemaData";Xmla.prototype={listeners:null,response:null,responseText:null,responseXml:null,setOptions:function(C){u(this.options,C,true)},addListener:function(H){var F=H.events;if(p(F)){throw"No events specified"}if(v(F)){if(F==="all"){F=Xmla.EVENT_ALL}else{F=F.split(",")}}if(!(F instanceof Array)){throw'Property "events" must be comma separated list string or array.'}var E=F.length;var C,G;for(var D=0;D<E;D++){C=F[D].replace(/\s+/g,"");G=this.listeners[C];if(!G){throw'Event "'+C+'" is not defined.'}if(B(H.handler)){if(!t(H.scope)){H.scope=window}G.push(H)}else{throw"Invalid listener: handler is not a function"}}},_fireEvent:function(H,K,D){var I=this.listeners[H];if(!I){throw'Event "'+H+'" is not defined.'}var G=I.length;var C=true;if(G){var E,J;for(var F=0;F<G;F++){E=I[F];J=E.handler.call(E.scope,H,K,this);if(D&&J===false){C=false;break}}}else{if(H==="error"){throw K}}return C},request:function(D){var E=this;var F=y(D);D.soapMessage=F;var G;var C={async:p(D.async)?this.options.async:D.async,timeout:this.options.requestTimeout,contentType:"text/xml",data:F,dataType:"xml",error:function(J,I,H){E._requestError({xmla:E,request:D,xhr:J,error:{errorCategory:"xhrError",errorString:I,errorObject:H}})},complete:function(H,I){if(I==="success"){E._requestSuccess({xmla:E,request:D,xhr:H,status:status})}},url:p(D.url)?this.options.url:D.url,type:"POST"};if(D.username){C.username=D.username}if(D.password){C.password=D.password}this.response=null;if(this._fireEvent(Xmla.EVENT_REQUEST,D,true)&&((D.method==Xmla.METHOD_DISCOVER&&this._fireEvent(Xmla.EVENT_DISCOVER,D))||(D.method==Xmla.METHOD_EXECUTE&&this._fireEvent(Xmla.EVENT_EXECUTE,D)))){G=d(C)}return this.response},_requestError:function(C){C.xmla=this;this._fireEvent("error",C)},_requestSuccess:function(I){var M=I.xhr;this.responseXML=M.responseXML;this.responseText=M.responseText;var H=I.request;var C=H.method;var E=k(this.responseXML,c,"Fault");if(E.length){E=E.item(0);var J=E.getElementsByTagName("faultcode").item(0).childNodes.item(0).data;var F=E.getElementsByTagName("faultstring").item(0).childNodes.item(0).data;var G={errorCategory:"soapFault",faultCode:J,faultString:F};I.error=G;switch(C){case Xmla.METHOD_DISCOVER:this._fireEvent(Xmla.EVENT_DISCOVER_ERROR,I);break;case Xmla.METHOD_EXECUTE:this._fireEvent(Xmla.EVENT_EXECUTE_ERROR,I);break}this._fireEvent(Xmla.EVENT_ERROR,I)}else{switch(C){case Xmla.METHOD_DISCOVER:var D=new Xmla.Rowset(this.responseXML);I.rowset=D;this.response=D;this._fireEvent(Xmla.EVENT_DISCOVER_SUCCESS,I);break;case Xmla.METHOD_EXECUTE:var K;var L=H.properties[Xmla.PROP_FORMAT];switch(L){case Xmla.PROP_FORMAT_TABULAR:break;case Xmla.PROP_FORMAT_MULTIDIMENSIONAL:break}I.resultset=K;this.response=K;this._fireEvent(Xmla.EVENT_EXECUTE_SUCCESS,I);break}this._fireEvent(Xmla.EVENT_SUCCESS,I)}},execute:function(C){var F,D=C.properties;if(p(D)){D={};C.properties=D}if(p(D[Xmla.PROP_CONTENT])){D[Xmla.PROP_CONTENT]=Xmla.PROP_CONTENT_SCHEMADATA}if(p(D[Xmla.PROP_FORMAT])){C.properties[Xmla.PROP_FORMAT]=Xmla.PROP_FORMAT_MULTIDIMENSIONAL}var E=u(C,{method:Xmla.METHOD_EXECUTE},true);return this.request(E)},discover:function(C){var D=u(C,{method:Xmla.METHOD_DISCOVER},true);return this.request(D)},discoverDataSources:function(C){var D=u(C,{requestType:Xmla.DISCOVER_DATASOURCES},true);return this.discover(D)},discoverProperties:function(C){var D=u(C,{requestType:Xmla.DISCOVER_PROPERTIES},true);return this.discover(D)},discoverSchemaRowsets:function(C){var D=u(C,{requestType:Xmla.DISCOVER_SCHEMA_ROWSETS},true);return this.discover(D)},discoverEnumerators:function(C){var D=u(C,{requestType:Xmla.DISCOVER_ENUMERATORS},true);return this.discover(D)},discoverKeywords:function(C){var D=u(C,{requestType:Xmla.DISCOVER_KEYWORDS},true);return this.discover(D)},discoverLiterals:function(C){var D=u(C,{requestType:Xmla.DISCOVER_LITERALS},true);return this.discover(D)},discoverDBCatalogs:function(C){var D=u(C,{requestType:Xmla.DBSCHEMA_CATALOGS},true);return this.discover(D)},discoverDBColumns:function(C){var D=u(C,{requestType:Xmla.DBSCHEMA_COLUMNS},true);return this.discover(D)},discoverDBProviderTypes:function(C){var D=u(C,{requestType:Xmla.DBSCHEMA_PROVIDER_TYPES},true);return this.discover(D)},discoverDBSchemata:function(C){var D=u(C,{requestType:Xmla.DBSCHEMA_SCHEMATA},true);return this.discover(D)},discoverDBTables:function(C){var D=u(C,{requestType:Xmla.DBSCHEMA_TABLES},true);return this.discover(D)},discoverDBTablesInfo:function(C){var D=u(C,{requestType:Xmla.DBSCHEMA_TABLES_INFO},true);return this.discover(D)},discoverMDActions:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_ACTIONS},true);return this.discover(D)},discoverMDCubes:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_CUBES},true);return this.discover(D)},discoverMDDimensions:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_DIMENSIONS},true);return this.discover(D)},discoverMDFunctions:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_FUNCTIONS},true);return this.discover(D)},discoverMDHierarchies:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_HIERARCHIES},true);return this.discover(D)},discoverMDLevels:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_LEVELS},true);return this.discover(D)},discoverMDMeasures:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_MEASURES},true);return this.discover(D)},discoverMDMembers:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_MEMBERS},true);return this.discover(D)},discoverMDProperties:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_PROPERTIES},true);return this.discover(D)},discoverMDSets:function(C){var D=u(C,{requestType:Xmla.MDSCHEMA_SETS},true);return this.discover(D)}};function w(G){var D=k(G,A,"complexType"),F=D.length,E,C;for(C=0;C<F;C++){E=D.item(C);if(E.getAttribute("name")==="row"){return E}}return null}Xmla.Rowset=function(D){this.rows=k(D,b,"row");this.numRows=this.rows?this.rows.length:0;this.rowIndex=0;this.row=(this.hasMoreRows())?this.rows.item(this.rowIndex):null;this.fieldOrder=[];this.fields={};this._fieldCount=0;var I=w(D);if(I){var N=k(I,A,"sequence").item(0);var F=N.childNodes;var H=F.length;var L,C,M,J,E,K;for(var G=0;G<H;G++){L=F.item(G);if(L.nodeType!=1){continue}C=l(L,g,"field");M=L.getAttribute("name");K=L.getAttribute("type");J=L.getAttribute("minOccurs");E=L.getAttribute("maxOccurs");this.fields[C]={name:M,label:C,index:this._fieldCount++,type:K,minOccurs:p(J)?1:J,maxOccurs:p(E)?1:(E==="unbounded"?Infinity:E),getter:this._createFieldGetter(M,K,J,E)};this.fieldOrder.push(C)}}else{throw"Couldn't parse XML schema while constructing resultset"}};Xmla.Rowset.FETCH_ARRAY=1;Xmla.Rowset.FETCH_OBJECT=2;Xmla.Rowset.prototype={node:null,_boolConverter:function(C){return C==="true"?true:false},_intConverter:function(C){return parseInt(C,10)},_floatConverter:function(C){return parseFloat(C,10)},_textConverter:function(C){return C},_arrayConverter:function(E,D){var C=[],G=E.length,H;for(var F=0;F<G;F++){H=E.item(F);C.push(H.tagName)}return C},_elementText:function(D){var G="",F=D.childNodes,E=F.length;for(var C=0;C<E;C++){G+=F.item(C).data}return G},_createFieldGetter:function(I,F,H,E){if(H===null){H="1"}if(E===null){E="1"}var G=this;var D=null;switch(F){case"xsd:boolean":D=G._boolConverter;break;case"xsd:decimal":case"xsd:double":case"xsd:float":D=G._floatConverter;break;case"xsd:int":case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:nonNegativeInteger":case"xsd:positiveInteger":case"xsd:short":case"xsd:byte":case"xsd:long":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":D=G._intConverter;break;case"xsd:string":D=G._textConverter;break;default:D=G._textConverter;break}var C;if(H==="1"&&E==="1"){C=function(){var J=k(this.row,b,I);return D(G._elementText(J.item(0)))}}else{if(H==="0"&&E==="1"){C=function(){var J=k(this.row,b,I);if(!J.length){return null}else{return D(G._elementText(J.item(0)))}}}else{if(H==="1"&&(E==="unbounded"||parseInt(E,10)>1)){C=function(){var J=k(this.row,b,I);return G._arrayConverter(J,D)}}else{if(H==="0"&&(E==="unbounded"||parseInt(E,10)>1)){C=function(){var J=k(this.row,b,I);if(!J.length){return null}else{return G._arrayConverter(J,D)}}}}}}return C},getFields:function(){var F=[],E=this._fieldCount,C=this.fieldOrder;for(var D=0;D<E;D++){F[D]=this.fieldDef(C[D])}return F},hasMoreRows:function(){return this.numRows>this.rowIndex},next:function(){this.row=this.rows.item(++this.rowIndex)},fieldDef:function(C){var D=this.fields[C];if(p(D)){throw'No such field: "'+C+'"'}return D},fieldIndex:function(C){var D=this.fieldDef(C);return D.index},fieldName:function(C){return this.fieldOrder[C]},fieldVal:function(C){if(x(C)){C=this.fieldName(C)}var D=this.fieldDef(C);return D.getter.call(this)},fieldCount:function(){return this._fieldCount},close:function(){this.row=null},fetchAsArray:function(){var F,C,E,D;if(this.hasMoreRows()){C=this.fields;F=[];for(E in C){if(C.hasOwnProperty(E)){D=C[E];F[D.index]=D.getter.call(this)}}this.next()}else{F=false}return F},fetchAsObject:function(){var D,C,F,E;if(this.hasMoreRows()){C=this.fields;D={};for(F in C){if(C.hasOwnProperty(F)){E=C[F];D[F]=E.getter.call(this)}}this.next()}else{D=false}return D},fetchAllAsArray:function(){var D,C=[];while((D=this.fetchAsArray())){C.push(D)}return C},fetchAllAsObject:function(){var D,C=[];while((D=this.fetchAsObject())){C.push(D)}return C}}}());