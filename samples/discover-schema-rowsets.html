<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!--
    Copyright 2009,2010 Roland Bouman 
    (Roland.Bouman@gmail.com, http://rpbouman.blogspot.com/, http://code.google.com/p/xmla4js)
    
    discover-schema-rowsets.html - this software is part of xmla4js

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->    
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>xmla4js: Discover Schema Rowsets</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css"/>
        <style type="text/css">
            #url {
                width: 100%;
            }
            
            .error {
                border-style:outset;
                border-width: 2px;
                margin-top: 1em;
                margin-bottom: 1em;
                background-color: red;
                color: white;
            }
            
            table {
                border-color: ThreeDFace;
                border-style: outset;
                border-width:2px;
            }
            td.th {
                font-weight: bold;
                text-align: center;
                background-color: ThreeDFace;
            }
            td {
            }
        </style>
    </head>
    <body>
        <div>
            <a href="../index.html">Home</a>
            |
            <a href="http://code.google.com/p/xmla4js/">Google Code Project page</a>
            |
            <a href="index.html">Samples</a>
            |
            <a href="../doc/api/index.html">API Reference Documentation</a>
        </div>
        <h1>Sample: Schema Rowsets</h1>
        <div>
            URL:
            <input type="text" id="url" name="url" 
                value="http://localhost:8080/pentaho/Xmla?userid=joe&amp;password=password"
            />
            <button id="discover">Discover...</button>            
        </div>

        <div id="schemaRowsets">
        </div>


        <script type="text/javascript" src="../src/Xmla.js"></script>
                
        <script type="text/javascript">
            var discover = document.getElementById("discover");
            var xmla = new Xmla({});

            discover.onclick = function(){
                var schemaRowsetsEl = document.getElementById("schemaRowsets");
                schemaRowsetsEl.innerHTML = "";

                var url = document.getElementById("url").value;
                xmla.setOptions({
                    async: false,
                    url: url
                });
                fillTable(Xmla.DISCOVER_DATASOURCES, xmla.discoverDataSources());
                fillTable(Xmla.DISCOVER_ENUMERATORS, xmla.discoverEnumerators());
                fillTable(Xmla.DISCOVER_KEYWORDS, xmla.discoverKeywords());
                fillTable(Xmla.DISCOVER_LITERALS, xmla.discoverLiterals());
                fillTable(Xmla.DISCOVER_PROPERTIES, xmla.discoverProperties());
                fillTable(Xmla.DISCOVER_SCHEMA_ROWSETS, xmla.discoverSchemaRowsets());
            }

            function fillTable(name, rowset){ 
                var tab = document.createElement("table");
                tab.setAttribute("border", "1");
                tab.createCaption().innerHTML = name;
                var schemaRowsetsEl = document.getElementById("schemaRowsets");
                schemaRowsetsEl.appendChild(tab);
                var c, i, r = tab.insertRow(0), fieldCount = rowset.fieldCount();
                for (i=0; i<fieldCount; i++){
                    c = r.insertCell(i);
                    c.innerHTML = rowset.fieldName(i);
                    c.setAttribute("class", "th");
                }
                var rows = rowset.fetchAllAsArray();                
                for (var rowCount = rows.length, j=0; j<rowCount; j++){
                    r = tab.insertRow(j+1);
                    for (i=0; i<fieldCount; i++){
                        c = r.insertCell(i);
                        c.innerHTML = rows[j][i];
                    }
                }
            }
            
        </script>
    </body>
</html>